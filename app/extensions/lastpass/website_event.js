var g_ipctarget=null,g_websiteeventtarget=null;
this.website_event=function(){var a=document.getElementById("eventtype").value;"function"==typeof lpdbg&&lpdbg("vault","new vault got website event: "+a);var c="function"==typeof getBG?getBG():bg,b={cmd:a,url:c.base_url,callback:website_event_callback};switch(a){case "refresh":b.from=document.getElementById("eventdata1").value;b.type=document.getElementById("eventdata2").value;break;case "logout":case "logoff":break;case "clearcache":break;case "keyweb2plug":b.cmd="web2plug";b.key=document.getElementById("eventdata1").value;
b.username=document.getElementById("eventdata2").value;b.rsa=document.getElementById("eventdata3").value;break;case "checkmultifactorsupport":b.type=document.getElementById("eventdata1").value;break;case "setupsinglefactor":b.type=document.getElementById("eventdata1").value;b.username=document.getElementById("eventdata2").value;b.password=document.getElementById("eventdata3").value;b.silent=document.getElementById("eventdata5").value;"1"!=document.getElementById("eventdata5").value&&g_websiteeventtarget&&
g_websiteeventtarget.source.postMessage({cmd:a,result:"working"},g_websiteeventtarget.origin);break;case "rsadecrypt":b.sharerpublickeyhex=document.getElementById("eventdata1").value;b.sharekeyenchexsig=document.getElementById("eventdata2").value;b.sharekeyenchex=document.getElementById("eventdata3").value;b.sharekeyhex=document.getElementById("eventdata4").value;break;case "request_native_messaging":break;default:console.error("got unsupported website event on new vault: "+a);return}c.processCS(null,
b,null)};
this.website_event_callback=function(a){"function"==typeof lpdbg&&lpdbg("vault","new vault got website event callback: "+a.cmd);"checkmultifactorsupport"==a.cmd?document.getElementById("lpwebsiteeventform")?(document.getElementById("eventdata4").value=a.type,document.getElementById("eventdata3").value=a.result,g_websiteeventtarget&&g_websiteeventtarget.source.postMessage(a,g_websiteeventtarget.origin)):forward_website_event_response(a):"setupsinglefactor"==a.cmd?document.getElementById("lpwebsiteeventform")?(document.getElementById("eventdata4").value=
a.result,g_websiteeventtarget&&g_websiteeventtarget.source.postMessage(a,g_websiteeventtarget.origin)):forward_website_event_response(a):"ipcgotdata"==a.cmd&&g_ipctarget.source.postMessage(a,g_ipctarget.origin)};function forward_website_event_response(a){for(var c=0;c<parent.frames.length;c++)if(parent.frames[c].document.getElementById("lpwebsiteeventform")&&"function"==typeof parent.frames[c].website_event_callback){parent.frames[c].website_event_callback(a);break}};
