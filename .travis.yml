language: node_js
node_js:
  - "6.1"
dist: trusty
sudo: required
before_install:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - openssl aes-256-cbc -K $encrypted_1366e420413c_key -iv $encrypted_1366e420413c_iv -in gpg_key.enc -out gpg_key -d
  - gpg --allow-secret-key-import --import gpg_key
  - pip install --user awscli
  - export PATH=$PATH:$HOME/.local/bin
# install aptly
  - echo 'deb http://repo.aptly.info/ squeeze main' | sudo tee -a /etc/apt/sources.list
  - sudo apt-key adv --keyserver keys.gnupg.net --recv-keys 9E3E53F19C7DE460
  - sudo apt-get update -qq
  - sudo apt-get install -y --force-yes aptly
  - aws s3 ls brave-apt-staging
script:
  - npm run lint
  - npm test
after_success:
  - npm install
  - CHANNEL=dev npm run build-package
  - echo 123 | gpg --passphrase $PASSPHRASE -s
  - npm run build-installer
  - bash tools/upload_to_aptly
  - bash tools/upload_to_rpm_repo
notifications:
  slack:
    secure: bDwO2uce5JAZvjrvWj4+/+yEXJAIK4O0RcgUWvZ2IMbi7Q9I89Mw40JmkLWL6x2gWZwxr8+FoLtErJA7RVrsfImjrX+NmMyAB7AydLdrBJtkLozNnuacnhcnBRyp1gGCa1ymxCEXGbgC6onAD3kiJJhggr70T+2lu3IuJYXENhc=
env:
  - CXX=g++-4.8 NODE_ENV=test
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - xvfb
      - g++-4.8
      - libgnome-keyring-dev
      - createrepo
      - expect

env:
  global:
    - secure: "SnC/JYCTk4sr6pI5ae8nB7MZrmckjVqTvwk0fCMIRzzbSRSLHnYyOsfMXalGy1dKK7k7sL5INlo8iSEqQAi4ScRSlE/0uPIa822sAFIp35kiWuGJzOWcplfBc9j6ecS6TsgHF15EAUgGZ89r932Swk2RK4nCL5HCVmrxc5moCcraGGIy80STkDdJaZbHjVGl9KwnOTW8iHbxo/Emd3r/yFH6MdFLWLYfgNiT36dzGZIl+sfQomjWyx3HhepsBiFXQYJgDpuiY8reOvRsbDwZUdbxDxbBQKwL3FMDOHgAzDArlY+8Dja7CBKyj+G5SFa8rN3RUNVuC2UyC2ZCb5tdolyxVB+zywrVnJYXAa6icdL7hMejrkn+lVht0tnx0NXjzFL/AI+hfOCm2CvQYi/Fezr2rXgQh2H35RaRFaft9tZsLv32KfJCwSIIDwnRZ8YCqb2cYqXp+pqR6smCd+i+USvV7FvaFdygyTDghnctDA/h67PVW1ZaUVV3In3L3fuI4ON7JUdhnyZVVsRIy30dHLw9WhUNFQqld0bu1MM7Q3QDZRAsgCB4JrulKtn88rXlA+3Zw0kZzOvUpJ7V3GaN8bE8lru6ZY6V8MWqX3oid0dO2HE4Z69Ev5L/N0E0Kh8NS9aA4Vu0mmiuDn6TPIRtOsV1hNmvzJB1PhTuBs4iUSo="
    - secure: "WPB5bMKQCvsIXixa7RlR+TQy4TS8E0Kk+ps7c531yjd9LiSo9BqNQDjWvfHRVnYAHS+TNySx7iTfvZiuLg8J8jN8LA1pEdjb9NFp9q403lSt6UhVbFyzpY/ylConPPCH21lIrOTziatj/J18/jTfENRpSwzIyHFVqBxJBF7xbsO1Z9cDbj8PM/+/+vT1NRG8Bb+ay8DBlzFdylu02XqVVL4i09j+WJ4bsdMSD+ihtzuRE4Am3D7P6thlWEJuElSAKR9CyiF4QLAo7d/GdmUe7VrvClO5eWyNyXzmcw99oP3cD3LEtw61xI8A25ya+JIYpGoauc0hB1oh+Hj3AYYpXJk65BUxtrwPpnUC4vAMkVO78cWftcVdXY7Ad8D4zBZNMtAgqllsVFY/fO3+roslfy98w06vAZhOxNBnkMu/0rq1+suUjHj/7KYulpeLIb35JMPYrtkaRqOp+U4z07HBKVVxh8LCdPBlhY6e8HFmiGbmuY/AhLlLsZzbrzuOOQ01HFPy9W/mk3BT2yyK5K9zkz4bHR8NTrbdG02MdUms+81EidGV8CZ1BoCtYLYRz6G7MNayoaAbPuqTvIIDiwr700xtD43WRMqtHKgcufFSegW6RFkYWEzgw5hrckWiN91MnlN6aMPVCWK+luJvEqJfk616r2oLfroA2F54hqxWurQ="
    - secure: "IiUIN0ZLNrYO8bJ8j4LYUEg1G8YybbI0J/0NvQaSMbL4jQ5Vh9wtSoryPW+X5MqUPiaFYmO/+9nD5tRw7hctnRTeNj2T20iCl4+y2VIFjBVEHu3OBHbbdNlUidUN1d9081DKzy9r3kspmGeaWJ9skit+mYoLaEhKiN9qCWYjsUUReA4NjcQGSvzBV/tdlU/W94a8KmwjtaENhK14wEOZjq3P1tBW//9BFmhtstF8iwutV5RfzsRxa8lQiSNGpWFCVbG8EMxNIEYCiLN4iW9jzSqxGDfF36E3nZWJN7J3LpOSttB0qBCK5KSP1zDptDjm5oIJ1AZUyedHXOdQZMlMFYJFlOsVVXl4ibsoEgt5ZnoMOvW1z+aiV5sIxapmMhTa1SFkGRG1k1LdAf2oKKl2guqUc0A3AgWK8Et7E4I8ibq6nk2YWiokgTBYc5zNV1k2hkvxiCRwdq/oyJW/S4CYkeEAsaI1pE+XAwDB/nxGL+CD54rcYvxv8qdBsdYX1+Fh2JoBupcAddQG3qdKAJUIkuCEMZIAZVmBs8TQWE/3oUm8Xkq4aLUOaSxwnuUdJ4TMuhLDgLl5T6QEYv06M4/Qn5+V3UYh1ei3f8q9CFjcQRDDiSgA3/rEV+1cZA6e+ZiS3ymWLyQv6WiqyzFIJFozTO+KOGl4SLbQ1/MOWD0U12E="
    - AWS_ACCESS_KEY_ID=$AWS_KEY
    - AWS_SECRET_ACCESS_KEY=$AWS_SECRET
